<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>home</title>
</head>

<script src="http://lib.sinaapp.com/js/jquery/2.2.4/jquery-2.2.4.min.js"></script>
<body>
<div>
    <label>用户名:</label> <input type="text" id="username">
    <label>密码:</label><input type="password" id="password" value="密码">
    <button id="login">登录</button>

    <button id="logout">退出</button>

    <div>
        <button id="findAll">获取产业园信息</button>
    </div>
</div>
</body>
<script>
    $(document).ready(function () {
        $("#login").click(function () {
            let param = {'username': $("#username").val(), 'password': $("#password").val()};
            $.ajax({
                type: "POST",
                url: " http://localhost:8080/web-example/api/user/login",
                dataType: "json",
                headers: {'Content-Type': 'application/json;charset=utf8'},
                data: JSON.stringify(param),
                success: function (data) {
                    let success = data.success;
                    if (success) {
                        alert("success");
                        let accessToken = data.data;
                        setCookie("accessToken", accessToken);
                    }
                },
                error: function (jqXHR) {
                    alert("error:" + JSON.stringify(data));
                }
            });
        });

        $("#logout").click(function () {
            let param = {};
            let accessToken = getCookie('accessToken');
            $.ajax({
                type: "POST",
                url: " http://localhost:8080/web-example/api/user/logout",
                dataType: "json",
                headers: {'Content-Type': 'application/json;charset=utf8', 'accessToken': accessToken},
                data: JSON.stringify(param),
                success: function (data) {
                    clearCookie();
                    alert(JSON.stringify(data))
                },
                error: function (jqXHR) {
                    alert("error:" + JSON.stringify(data));
                }
            });
        });

        $("#findAll").click(function () {
            let param = {};
            let accessToken = getCookie('accessToken');
            $.ajax({
                type: "POST",
                url: " http://localhost:8080/web-example/api/industryPark/findAll",
                dataType: "json",
                headers: {'Content-Type': 'application/json;charset=utf8', 'accessToken': accessToken},
                data: JSON.stringify(param),
                success: function (data) {
                    alert(JSON.stringify(data))
                },
                error: function (jqXHR) {
                    alert("error:" + JSON.stringify(data));
                }
            });
        });

        function setCookie(name, value) {
            //设置名称为name,值为value的Cookie
            let expdate = new Date();   // 初始化时间
            expdate.setTime(expdate.getTime() + 30 * 60 * 1000);   //时间
            document.cookie = name + "=" + value + ";expires=" + expdate.toGMTString() + ";path=/";
            //即document.cookie= name+"="+value+";path=/";   时间可以不要，但路径(path)必须要填写，因为JS的默认路径是当前页，如果不填，此cookie只在当前页面生效！~
        }

        function getCookie(c_name) {
            if (document.cookie.length > 0) {
                c_start = document.cookie.indexOf(c_name + "=")
                if (c_start != -1) {
                    c_start = c_start + c_name.length + 1
                    c_end = document.cookie.indexOf(";", c_start)
                    if (c_end == -1) c_end = document.cookie.length
                    return unescape(document.cookie.substring(c_start, c_end))
                }
            }
            return ""
        }


        function clearCookie() {
            let keys = document.cookie.match(/[^ =;]+(?=\=)/g);
            if (keys) {
                for (let i = keys.length; i--;) {
                    document.cookie = keys[i] + '=0;path=/;expires=' + new Date(0).toUTCString();//清除当前域名下的,例如：m.kevis.com
                    document.cookie = keys[i] + '=0;path=/;domain=' + document.domain + ';expires=' + new Date(0).toUTCString();//清除当前域名下的，例如 .m.kevis.com
                    document.cookie = keys[i] + '=0;path=/;domain=kevis.com;expires=' + new Date(0).toUTCString();//清除一级域名下的或指定的，例如 .kevis.com
                }
            }
        }
    });
</script>
</html>